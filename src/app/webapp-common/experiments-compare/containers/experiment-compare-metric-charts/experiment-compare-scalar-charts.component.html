<mat-drawer-container [hasBackdrop]="false" autosize class="light-theme">
  <mat-drawer #drawer [opened]="!minimized" [mode]="minimized ? 'over' : 'side'" [disableClose]="!minimized">
    <div class="list-container">
      @if (!minimized) {
        <sm-graph-settings-bar
          class="drawer-settings-bar"
          [verticalLayout]="true"
          [smoothWeight]="settings.smoothWeight"
          [smoothSigma]="settings.smoothSigma"
          [smoothType]="settings.smoothType"
          [xAxisType]="settings.xAxisType"
          [showOrigin]="settings.showOriginals"
          [groupBy]="settings.groupBy"
          [groupByOptions]="groupByOptions"
          [clearable]="null"
          (changeWeight)="changeSmoothness($event)"
          (changeSigma)="changeSigma($event)"
          (toggleSettings)="toggleSettingsBar()"
          (changeXAxisType)="changeXAxisType($event)"
          (changeGroupBy)="changeGroupBy($event)"
          (changeSmoothType)="changeSmoothType($event)"
          (changeShowOrigin)="changeShowOriginals($event)"
        ></sm-graph-settings-bar>
        <div class="line-width-control">
          <div class="label">Line Width</div>
          <div class="slider-row">
            <mat-slider [min]="0.3" [max]="7" [step]="0.1">
              <input matSliderThumb [value]="lineWidth" (valueChange)="changeLineWidth($any($event))"/>
            </mat-slider>
            <input class="line-width-input" type="number" step="0.1" [min]="0.3" [max]="7" [value]="lineWidth" (input)="changeLineWidth($any($event.target.value))"/>
          </div>
        </div>
        <div class="runs-sidebar-list">
          <div class="runs-sidebar-header">Runs</div>
          @if (experiments$ | ngrxPush) {
            <div class="runs-list">
              @for (run of (experiments$ | ngrxPush); track run.id) {
                <div
                  class="run-row"
                  (mouseenter)="highlightRun(run.id)"
                  (mouseleave)="clearHighlight()"
                >
                  <mat-checkbox
                    class="run-visibility"
                    [checked]="!hiddenRuns.has(run.id)"
                    (change)="setRunVisibility(run.id, $event.checked)"
                  ></mat-checkbox>
                  <span
                    #runColor
                    class="run-color"
                    [style.background-color]="experimentsColor[run.id]"
                    [colorButtonRef]="runColor"
                    [smChooseColor]="experimentsColor[run.id]"
                    [stringToColor]="run.name + '-' + run.id"
                  ></span>
                  <span class="run-name ellipsis" [attr.title]="run.name">{{ run.name }}</span>
                  <button mat-icon-button [matMenuTriggerFor]="runMenu" class="run-actions" (click)="$event.stopPropagation()">
                    <mat-icon fontSet="al" fontIcon="al-ico-bars-menu"></mat-icon>
                  </button>
                  <mat-menu #runMenu="matMenu">
                    <button mat-menu-item (click)="viewRun(run)">
                      <mat-icon fontSet="al" [fontIcon]="icons.DETAILS"></mat-icon>
                      <span>View run</span>
                    </button>
                    <button mat-menu-item (click)="renameRun(run)">
                      <mat-icon fontSet="al" [fontIcon]="icons.EDIT"></mat-icon>
                      <span>Rename</span>
                    </button>
                    <button mat-menu-item (click)="deleteRun(run)">
                      <mat-icon fontSet="al" [fontIcon]="icons.REMOVE"></mat-icon>
                      <span>Delete</span>
                    </button>
                  </mat-menu>
                </div>
              }
            </div>
          }
        </div>
      }
      @if (!minimized) {
        <sm-selectable-grouped-filter-list
          [list]="graphList"
          [nested]="settings.groupBy === 'none'"
          [checkedList]="settings.selectedMetricsScalar"
          [searchTerm]="searchTerm$ | ngrxPush"
          (itemSelect)="metricSelected($event)"
          (selectedChanged)="selectedListChanged($event)"
          (searchTermChanged)="searchTermChanged($event)"
        >
        </sm-selectable-grouped-filter-list>
      }
    </div>
  </mat-drawer>
  <mat-drawer-content class="overflow-hidden">
    <sm-experiment-graphs
      [class.hidden]="loading()"
      [metrics]="graphs"
      [list]="graphList"
      [hiddenList]="settings.selectedMetricsScalar"
      [isGroupGraphs]="settings.groupBy === 'none'"
      [isCompare]="true"
      [hideLegend]="minimized"
      [smoothWeight]="settings.smoothWeight"
      [smoothSigma]="settings.smoothSigma"
      [smoothType]="settings.smoothType"
      [xAxisType]="settings.xAxisType"
      [groupBy]="settings.groupBy"
      [showOriginals]="settings.showOriginals"
      [multipleSingleValueData]="singleValuesChart"
      [exportForReport]="!modelsFeature"
      [minimized]="minimized"
      [breakPoint]="900"
      [splitSize]="splitSize$ | ngrxPush"
      [defaultHoverMode]="'x'"
      (resetGraphs)="resetMetrics()"
      (createEmbedCode)="createEmbedCode($event)"
      (chartSettingsChanged)="changeChartSettings($event)"
    ></sm-experiment-graphs>
  </mat-drawer-content>
</mat-drawer-container>


@if (minimized) {
  <div class="menu-trigger"
       smClickStopPropagation
       [matMenuTriggerFor]="graphSettingsMenu">
  </div>
  <mat-menu #graphSettingsMenu="matMenu" (closed)="toggleSettingsBar()">
    <sm-graph-settings-bar
      smClickStopPropagation
      class="graph-settings-menu"
      [verticalLayout]="true"
      [smoothWeight]="settings.smoothWeight"
      [smoothSigma]="settings.smoothSigma"
      [smoothType]="settings.smoothType"
      [xAxisType]="settings.xAxisType"
      [showOrigin]="settings.showOriginals"
      [groupBy]="settings.groupBy"
      [groupByOptions]="groupByOptions"
      [splitSize]="splitSize$ | ngrxPush"
      [clearable]="null"
      (changeWeight)="changeSmoothness($event)"
      (changeSigma)="changeSigma($event)"
      (toggleSettings)="toggleSettingsBar()"
      (changeXAxisType)="changeXAxisType($event)"
      (changeGroupBy)="changeGroupBy($event)"
      (changeSmoothType)="changeSmoothType($event)"
      (changeShowOrigin)="changeShowOriginals($event)"
    ></sm-graph-settings-bar>
    <div class="line-width-control">
      <div class="label">Line Width</div>
      <div class="slider-row">
        <mat-slider [min]="0.3" [max]="7" [step]="0.1">
          <input matSliderThumb [value]="lineWidth" (valueChange)="changeLineWidth($any($event))"/>
        </mat-slider>
        <input class="line-width-input" type="number" step="0.1" [min]="0.3" [max]="7" [value]="lineWidth" (input)="changeLineWidth($any($event.target.value))"/>
      </div>
    </div>
  </mat-menu>
}

<ng-template #renameRunDialog let-run>
  <div class="rename-dialog">
    <label for="run-name-input">New name</label>
    <input id="run-name-input" type="text" [(ngModel)]="renameValue" class="rename-input" />
  </div>
</ng-template>
